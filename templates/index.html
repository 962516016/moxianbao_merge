<!DOCTYPE html>
<html lang="en" xmlns="">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>主页-油专特供</title>
    <link href="../favicon.ico" rel="shortcut icon">
    <link href="../static/css/typicons.css" rel="stylesheet">
    <link href="../static/css/vendor.bundle.base.css" rel="stylesheet">
    <link href="../static/css/style.css" rel="stylesheet">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="../static/js/jquery.js"></script>
    <script src="../static/js/echarts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
    <script src="https://www.itxst.com/package/bootstrap-4.5.0/js/bootstrap.min.js"></script>
    <script src="https://www.itxst.com/package/bootstrap-datepicker-1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://www.itxst.com/package/bootstrap-datepicker-1.9.0/locales/bootstrap-datepicker.zh-CN.min.js"></script>
</head>
<body>
<i id="bannerClose"></i>
<div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
            <a class="navbar-brand brand-logo" href=""><img alt="logo" src="static/picture/logo.svg"></a>
            <a class="navbar-brand brand-logo-mini" href=""><img alt="logo" src="static/picture/logo-mini.svg"></a>
            <button class="navbar-toggler navbar-toggler align-self-center d-none d-lg-flex" data-toggle="minimize"
                    type="button">
                <span class="typcn typcn-th-menu"></span>
            </button>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
            <ul class="navbar-nav navbar-nav-right">
                <li class="nav-item d-none d-lg-flex  mr-2">
                    {% if username %}
                    <span style="font-weight: bold">欢迎您, {{ username }}</span>
                    <a class="nav-link" href="/logout">
                        退出登录
                    </a>
                    {% else %}
                    <span style="font-weight: bold;--xr-font-color0: true">您好, 请</span>
                    <a class="nav-link" href="/">
                        点此登录
                    </a>
                    {% endif %}
            </ul>
            <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" data-toggle="offcanvas"
                    type="button">
                <span class="typcn typcn-th-menu"></span>
            </button>
        </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_settings-panel.html -->
        <div id="nav-placeholder">
            <nav class="sidebar sidebar-offcanvas" id="sidebar">

            </nav>
        </div>

        {% if username %}
        <!--        登录才给全功能-->
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="card">
                    <div class="card-body" style="border: none">
                        <!--                选择器按钮部分-->
                        <div class="row flex-grow w-100 d-flex js justify-content-center align-content-center d-flex">
                            <!--                    正在设计功能-日期选择器-datepicker-->
                            <div class="col-8 justify-content-center align-content-end d-flex"
                                 style="padding-right: 0!important;padding-left: 0!important;">
                                <div class="col-12 justify-content-center align-content-center d-flex">
                                    <div class="input-container form-control input-box m-auto" id="input-group"
                                         style="border: none!important;">
                                        <div class="row mx-1">
                                            <div class="col-xl-2 mb-sm-2 d-flex align-items-center justify-content-center"
                                                 style="padding-right: 0!important;padding-left: 0!important;">
                                                <label class="mb-0" for="turb-input" style="width: 100%">
                                                    <div class="row flex-lg-grow d-flex justify-content-start align-items-start">
                                                        <span style="font-weight: bold">请选择风场</span>
                                                    </div>
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <select class="input timeinput" id="turb-input"
                                                                onchange="turb_update()">
                                                            <!--                                        <option>1</option>-->
                                                            <!--                                        <option>2</option>-->
                                                            <!--                                        <option>3</option>-->
                                                            <!--                                        <option>4</option>-->
                                                            <!--                                        <option>5</option>-->
                                                            <!--                                        <option>6</option>-->
                                                            <!--                                        <option>7</option>-->
                                                            <!--                                        <option>8</option>-->
                                                            <!--                                        <option>9</option>-->
                                                            <!--                                        <option>10</option>-->
                                                            <option>11</option>
                                                            <option>12</option>
                                                            <option selected>13</option>
                                                            <option>14</option>
                                                            <option>15</option>
                                                            <option>16</option>
                                                            <option>17</option>
                                                            <option>18</option>
                                                            <option>19</option>
                                                            <option>20</option>
                                                        </select>
                                                    </div>
                                                </label>
                                            </div>
                                            <div class="col-xl-4 mb-sm-2 d-flex align-items-center justify-content-center"
                                                 style="padding-right: 0!important;padding-left: 0!important;">
                                                <label class="mb-0" for="time-input" style="width: 100%">
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <span style="font-weight: bold">请选择结束时间</span>
                                                    </div>
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <input class="input timeinput"
                                                               id="time-input"
                                                               max="2024-06-14T00:00"
                                                               min="2018-06-07T00:00"
                                                               name="meeting-time"
                                                               oninput=""
                                                               onporpertychange="getValue();"
                                                               type="datetime-local"
                                                               value="2021-11-26T06:00"
                                                        >
                                                    </div>
                                                </label>
                                            </div>
                                            <div class="col-xl-4 mb-sm-2 d-flex align-items-center justify-content-center"
                                                 style="padding-right: 0!important;padding-left: 0!important;">
                                                <label class="mb-0" for="length-input" style="width: 100%">
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <span style="font-weight: bold">请选择数据时长 - </span><span
                                                            id="len">10</span><span>日</span>
                                                    </div>
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <input class="input lengthinput"
                                                               id="length-input"
                                                               max="30"
                                                               min="7"
                                                               name="length-input"
                                                               oninput=""
                                                               onporpertychange="selectChange();"
                                                               type="range"
                                                               value="10"
                                                        >
                                                    </div>
                                                </label>
                                            </div>
                                            <div class="col-xl-2 mb-sm-2 d-flex align-items-center justify-content-center"
                                                 style="padding-right: 0!important;padding-left: 0!important;display: none!important;">
                                                <button class="btn btn-sm btn-outline-secondary text-start m-auto"
                                                        id="changepwdBtn"
                                                        onclick="selectChange();"
                                                        style="text-align: start; margin: 0"
                                                >预览数据
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--                    正在设计功能-预测时长选择器-lengthselector-->
                            <div class="col-4 justify-content-start align-items-end d-flex"
                                 style="padding-right: 0!important;padding-left: 0!important;">
                                <div class="col-12 align-items-end justify-content-sm-end d-flex"
                                     style="padding: 0!important;">
                                    <div class="input-container form-control input-box m-auto" id="input-group2"
                                         style="border: none!important;">
                                        <div class="row mx-1">
                                            <div class="col-xl-9 mb-sm-2 d-flex align-items-start justify-content-start"
                                                 style="padding-right: 0!important;padding-left: 0!important;">
                                                <label class="mb-0" for="length2-input" style="width: 100%;">
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <span style="font-weight: bold">请选择预测时长 - </span>
                                                        <span id="len2">12</span><span>小时</span>
                                                    </div>
                                                    <div class="row flex-grow d-flex justify-content-start align-items-start">
                                                        <input class="input lengthinput"
                                                               id="length2-input"
                                                               max="24"
                                                               min="5"
                                                               name="length-input"
                                                               oninput=""
                                                               onporpertychange=""
                                                               type="range"
                                                               value="12"
                                                        >
                                                    </div>

                                                </label>

                                            </div>
                                            <div class="col-xl-3 mb-sm-2 d-flex align-items-center justify-content-end"
                                                 style="padding-right: 0!important;padding-left: 0!important;">
                                                <button class="btn btn-sm btn-outline-secondary text-center m-auto"
                                                        id="changepwdBtn2"
                                                        onclick="main2_update()"
                                                        style="text-align: center; margin: 0"
                                                >预测
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--                主图表区域-->
                        <div class="row flex-grow w-100 " style="margin-top: 10px">
                            <div class="col-lg-7 d-flex grid-margin stretch-card pr-0">
                                <div class="card pr-0 px-0">
                                    <div class="card-body px-0 pr-0 mx-2 mr-n1 d-flex justify-content-end align-items-end"
                                         id="main-container" style="border-right: 2px dashed #000!important;">
                                        <div id="main" style="width: 100%;height:500px;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 d-flex grid-margin stretch-card px-0 pr-0"
                                 style="padding-left: 0!important;">
                                <div class="card px-0 pr-0">
                                    <div class="card-body px-0 pr-0 mx-0 mr-2" id="main-container2"
                                         style="border-left: 2px dashed #000!important;">
                                        <div id="main2" style="width: 100%;height:500px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--                风向+3D-->
                <div class="row  mt-3">
                    <!--                    风向图-->
                    <div class="col-xl-5 d-flex grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <div class="rosechart" id="rosechart">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--                    3D图-->
                    <div class="col-xl-7 d-flex grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex d3chart" id="3dchart"
                                     style="width: 100%;height: 400px">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="footer-placeholder">

            </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html 页脚 -->

        <!-- partial -->

        {% else %}
        <!--        没登录啥都不显示-->
        <div class="main-panel">
            <div class="content-wrapper">
                <span style="text-align: center;font-size: 40px">
                    <a href="/">请登录</a>
                </span>
            </div>
        </div>
        {% endif %}
        <!-- main-panel ends -->
    </div>
</div>

<!-- page-body-wrapper ends -->
</div>
<!-- container-scroller -->
<!-- base:js -->
<script src="../static/js/vendor.bundle.base.js"></script>
<script src="../static/js/off-canvas.js"></script>
<script src="../static/js/hoverable-collapse.js"></script>
<script src="../static/js/template.js"></script>
<script src="../static/js/progressbar.min.js"></script>
<script src="../static/js/nav-footer_loader.js"></script>
<script src="../static/js/index-update.js"></script>
<script>


    let mn = 10000000000
    let mx = -10000000000
    let TEMP = 0

    async function main() {
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'), null, {renderer: 'svg'});
        myChart.showLoading()


        var input = document.getElementById('time-input');
        var dateinput = input.value.split('T')[0].split('-')
        var timeinput = input.value.split('T')[1].split(':')

        var turbinput = document.getElementById('turb-input').value;
        var lengthinput = document.getElementById('length-input').value;

        let turbid = turbinput;
        let year = dateinput[0];
        let month = dateinput[1];
        let day = dateinput[2];
        let hour = timeinput[0];
        let length = lengthinput;// 单位小时

        const baseurl = '/predict_value?' + 'turbid=' + turbid + '&&year=' + year +
            '&&month=' + month + '&&day=' + day + '&&hour=' + hour + '&&length=' + length
        console.log('测试ssy:', baseurl);
        // (async function (){
        //     myChart.hideLoading();
        // })();

        // GET请求
        axios.get(baseurl)
            .then(res => {
                console.log('测试resdata', res.data)

                let datetimeline = Object.entries(res.data)[0][1];
                let roundline = Object.entries(res.data)[1][1];
                let yd15line = Object.entries(res.data)[2][1];

                console.log('测试datetimeline', datetimeline)
                console.log('测试roundline', roundline)
                console.log('测试yd15line', yd15line)

                let datetime = []
                let round = []
                let yd15 = []


                for (let i = 0; i < datetimeline.length; i++) {
                    datetime.push((datetimeline[i]))
                    round.push(Math.round(roundline[i]))
                    yd15.push(Math.round(yd15line[i]))
                    mn = Math.min(mn, roundline[i], yd15line[i])
                    mx = Math.max(mx, roundline[i], yd15line[i])
                }
                console.log(mn)
                console.log(mx)
                var option = {
                    tooltip: {
                        trigger: 'axis',
                        position: 'left'
                    },
                    title: {
                        left: 'center',
                        text: '功率数据',
                    },
                    legend: {
                        data: ['供电功率', '发电功率',],
                        show: true,
                        itemHeight: 20,
                        top: '6%'
                    },
                    grid: {
                        left: '20%',
                        right: 0
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        position: 'left',
                        type: 'category',
                        boundaryGap: false,
                        data: datetime,
                        axisLabel: {
                            align: 'left' // 将标签对齐方式设置为右对齐
                        }
                    },
                    yAxis: {
                        position: 'left',
                        min: Math.round(mn * 1.1),
                        max: Math.round(mx * 1.1),
                        type: 'value',
                        boundaryGap: [0, '100%']
                    },
                    dataZoom: [
                        {
                            type: 'inside',
                            start: 0,
                            end: 100
                        },
                        {
                            start: 0,
                            end: 30
                        }
                    ],
                    series: [
                        {
                            name: '发电功率',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: round
                        },
                        {
                            name: '供电功率',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: yd15
                        },
                    ]
                };
                myChart.hideLoading()
                myChart.setOption(option);
                // myChart.hideLoading();
                // const container = document.getElementById()
                window.onresize = function () {
                    myChart.resize();
                }

            })
            .catch(err => {
                console.error('axios请求错误' + err)
            })
        // 使用刚指定的配置项和数据显示图表。
    }

    main()

    async function main2init0() {
        // 基于准备好的dom，初始化echarts实例
        let chartdom = document.getElementById('main2')
        chartdom.innerHTML = ''
        var myChart = echarts.init(chartdom, null, {renderer: 'svg'});
        myChart.showLoading()
        var input = document.getElementById('time-input');
        var dateinput = input.value.split('T')[0].split('-')
        var timeinput = input.value.split('T')[1].split(':')

        var turbinput = document.getElementById('turb-input').value;
        var lengthinput2 = document.getElementById('length2-input').value;

        let turbid = turbinput;
        let year = dateinput[0];
        let month = dateinput[1];
        let day = dateinput[2];
        let hour = timeinput[0];
        let length2 = lengthinput2;// 单位小时

        // /train_predict?
        const baseurl = '/train_predict2?' + 'turbid=' + turbid + '&&year=' + year +
            '&&month=' + month + '&&day=' + day + '&&hour=' + hour + '&&length=' + length2
        console.log('测试ssy2:', baseurl);

        // GET请求
        axios.get(baseurl)
            .then(res => {
                console.log('测试resdata-main2init0', res.data)
                let datetimeline = Object.entries(res.data)[0][1];
                let roundline = Object.entries(res.data)[1][1];
                let yd15line = Object.entries(res.data)[2][1];

                console.log('测试datetimeline2', datetimeline)
                console.log('测试roundline2', roundline)
                console.log('测试yd15line2', yd15line)

                let datetime = []
                let yd15 = []
                let round = []

                for (let i = 0; i < datetimeline.length; i++) {
                    datetime.push((datetimeline[i]))
                    round.push(Math.round(roundline[i]))
                    yd15.push(Math.round(yd15line[i]))
                }
                console.log('2', mn)
                console.log('2', mx)
                var option = {
                    tooltip: {
                        trigger: 'axis',
                        position: 'left'
                    },
                    title: {
                        left: 'center',
                        text: '功率预测数据',
                    },
                    legend: {
                        data: ['供电功率', '发电功率'],
                        show: true,
                        itemHeight: 20,
                        top: '6%'
                    },
                    grid: {
                        left: 0,
                        right: '20%'
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        position: 'right',
                        type: 'category',
                        boundaryGap: false,
                        // data: datetime,
                        // inverse: true
                        axisLabel: {
                            align: 'left' // 将标签对齐方式设置为右对齐
                        }
                    },
                    yAxis: {
                        position: 'right',
                        // min: Math.round(mn * 1.1),
                        // max: Math.round(mx * 1.1),
                        type: 'value',
                        boundaryGap: [0, '100%']
                    },
                    dataZoom: [
                        {
                            left: '-2%',
                            type: 'slider',
                            start: 0,
                            end: 100
                        }
                    ]
                };
                myChart.setOption(option);
                window.onresize = function () {
                    myChart.resize();
                }

            })
            .catch(err => {
                console.error('axios请求错误' + err)
            })
        // 使用刚指定的配置项和数据显示图表。
    }

    main2init0()


    async function main2init() {
        // 基于准备好的dom，初始化echarts实例
        let mydom = document.getElementById('main2');
        var myChart = echarts.init(mydom, null, {renderer: 'svg'});

        var input = document.getElementById('time-input');
        var dateinput = input.value.split('T')[0].split('-')
        var timeinput = input.value.split('T')[1].split(':')

        var turbinput = document.getElementById('turb-input').value;
        var lengthinput2 = document.getElementById('length2-input').value;

        let turbid = turbinput;
        let year = dateinput[0];
        let month = dateinput[1];
        let day = dateinput[2];
        let hour = timeinput[0];
        let length2 = lengthinput2;// 单位小时

        // /train_predict?
        const baseurl = '/train_predict2?' + 'turbid=' + turbid + '&&year=' + year +
            '&&month=' + month + '&&day=' + day + '&&hour=' + hour + '&&length=' + length2
        console.log('测试ssy-main2init:', baseurl);

        // GET请求
        axios.get(baseurl)
            .then(res => {
                myChart.setOption({series: [{data: []}]})
                myChart.resize()
                console.log('测试resdata-main2init', res.data)
                let datetimeline = Object.entries(res.data)[1][1];
                let roundline = Object.entries(res.data)[0][1];
                let yd15line = Object.entries(res.data)[2][1];

                console.log('测试datetimeline-main2init', datetimeline)

                let datetime = []
                let yd15 = []
                let round = []

                for (let i = 0; i < datetimeline.length; i++) {
                    datetime.push((datetimeline[i]))
                    round.push(Math.round(roundline[i]))
                    yd15.push(Math.round(yd15line[i]))
                }
                console.log('2', mn)
                console.log('2', mx)

                var option = {
                    tooltip: {
                        trigger: 'axis',
                        position: 'left'
                    },
                    title: {
                        left: 'center',
                        text: '功率预测数据',
                    },
                    legend: {
                        data: ['供电功率', '发电功率'],
                        show: true,
                        itemHeight: 20,
                        top: '6%'
                    },
                    grid: {
                        left: 0,
                        right: '20%'
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        position: 'right',
                        type: 'category',
                        boundaryGap: false,
                        data: datetime,
                        // inverse: true
                        axisLabel: {
                            align: 'left' // 将标签对齐方式设置为右对齐
                        }
                    },
                    yAxis: {
                        position: 'right',
                        min: Math.round(mn * 1.1),
                        max: Math.round(mx * 1.1),
                        type: 'value',
                        boundaryGap: [0, '100%']
                    },
                    dataZoom: [
                        {
                            left: '-2%',
                            type: 'slider',
                            start: 0,
                            end: 100
                        }
                    ],
                    series: [
                        {
                            name: '供电功率',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: yd15
                        },
                        {
                            name: '发电功率',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: round
                        },
                    ]
                };
                myChart.hideLoading()
                myChart.setOption(option);
                // myChart.resize()
                // myChart.showLoading();

                // const container = document.getElementById()
                window.onresize = function () {
                    myChart.resize();
                }

            })
            .catch(err => {
                console.error('axios请求错误' + err)
            })
        // 使用刚指定的配置项和数据显示图表。
    }

    main2init()

    async function main2() {
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main2'), null, {renderer: 'svg'});
        myChart.showLoading();

        var input = document.getElementById('time-input');
        var dateinput = input.value.split('T')[0].split('-')
        var timeinput = input.value.split('T')[1].split(':')

        var turbinput = document.getElementById('turb-input').value;
        var lengthinput2 = document.getElementById('length2-input').value;

        let turbid = turbinput;
        let year = dateinput[0];
        let month = dateinput[1];
        let day = dateinput[2];
        let hour = timeinput[0];
        let length2 = lengthinput2;// 单位小时

        // /train_predict?
        const baseurl = '/train_predict?' + 'turbid=' + turbid + '&&year=' + year +
            '&&month=' + month + '&&day=' + day + '&&hour=' + hour + '&&length=' + length2
        console.log('测试ssy-main2:', baseurl);

        // GET请求
        axios.get(baseurl)
            .then(res => {
                console.log('测试resdata-main2', res.data)
                let datetimeline = Object.entries(res.data)[1][1];
                let pre_roundline = Object.entries(res.data)[2][1];
                let pre_yd15line = Object.entries(res.data)[3][1];
                let roundline = Object.entries(res.data)[0][1];
                let yd15line = Object.entries(res.data)[4][1];

                console.log('测试datetimeline-main2', datetimeline)
                console.log('测试pre_roundline-main2', pre_roundline)
                console.log('测试pre_yd15line-main2', pre_yd15line)

                let datetime = []
                let pre_yd15 = []
                let pre_round = []
                let yd15 = []
                let round = []

                for (let i = 0; i < datetimeline.length; i++) {
                    datetime.push((datetimeline[i]))
                    pre_round.push(Math.round(pre_roundline[i]))
                    pre_yd15.push(Math.round(pre_yd15line[i]))
                    round.push(Math.round(roundline[i]))
                    yd15.push(Math.round(yd15line[i]))
                }
                console.log('2', mn)
                console.log('2', mx)
                var option = {
                    tooltip: {
                        trigger: 'axis',
                        position: 'left'
                    },
                    title: {
                        left: 'center',
                        text: '功率预测数据',
                    },
                    legend: {
                        data: ['供电功率', '发电功率', '供电功率预测', '发电功率预测'],
                        show: true,
                        itemHeight: 20,
                        top: '6%'
                    },
                    grid: {
                        left: 0,
                        right: '20%'
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        position: 'right',
                        type: 'category',
                        boundaryGap: false,
                        data: datetime,
                        // inverse: true
                        axisLabel: {
                            align: 'left' // 将标签对齐方式设置为右对齐
                        }
                    },
                    yAxis: {
                        position: 'right',
                        min: Math.round(mn * 1.1),
                        max: Math.round(mx * 1.1),
                        type: 'value',
                        boundaryGap: [0, '100%']
                    },
                    dataZoom: [
                        {
                            left: '-2%',
                            type: 'slider',
                            start: 0,
                            end: 100
                        }
                    ],
                    series: [
                        {
                            name: '供电功率',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: yd15
                        },
                        {
                            name: '发电功率',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: round
                        },
                        {
                            name: '供电功率预测',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: pre_yd15
                        },
                        {
                            name: '发电功率预测',
                            type: 'line',
                            smooth: true,
                            symbol: 'none',
                            //areaStyle: {},
                            data: pre_round
                        },

                    ]
                };
                myChart.hideLoading()
                myChart.setOption(option);
                // myChart.hideLoading();
                // myChart.resize();
                // const container = document.getElementById()
                window.onresize = function () {
                    myChart.resize();
                }
            })
            .catch(err => {
                console.error('axios请求错误' + err)
            })
        // 使用刚指定的配置项和数据显示图表。
    }


    async function rose() {
        var roseChart = echarts.init(document.getElementById('rosechart'), null, {renderer: 'svg'});
        var turbinput = document.getElementById('turb-input').value;
        var turbid = turbinput

        const url = '/get_winddirection?' + 'turbid=' + turbid

        // GET请求
        axios.get(url)
            .then(res => {
                var tmp = res.data.direction;
                let cnt = [parseInt(tmp[1])];
                for (let i = 2; i <= 8; i++) {
                    cnt.push(parseInt(tmp[i]));
                }
                // console.log(cnt)
                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: '风向玫瑰图'
                    },
                    legend: {
                        top: 'bottom',
                        data: []
                    },
                    grid: {
                        left: '10%',
                        right: '10%'
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b} : {c} ({d}%)'
                    },
                    toolbox: {
                        show: true,
                        feature: {
                            saveAsImage: {show: true}
                        }
                    },
                    series: [
                        {
                            name: '风向统计玫瑰图',
                            type: 'pie',
                            radius: [30, 80],
                            center: ['50%', '50%'],
                            roseType: 'area',
                            itemStyle: {
                                borderRadius: 8
                            },
                            data: [
                                {value: cnt[0], name: '正北'},
                                {value: cnt[1], name: '东北'},
                                {value: cnt[2], name: '正东'},
                                {value: cnt[3], name: '东南'},
                                {value: cnt[4], name: '正南'},
                                {value: cnt[5], name: '西南'},
                                {value: cnt[6], name: '正西'},
                                {value: cnt[7], name: '西北'}
                            ]
                        }
                    ]
                };
                roseChart.setOption(option)
                window.onresize = function () {
                    roseChart.resize();
                }
            })
            .catch(err => {
                console.error('axios请求错误' + err)
            })
    }

    rose()

    async function d3chart() {
        var d3chart = echarts.init(document.getElementById('3dchart'));
        // 指定图表的配置项和数据
        // prettier-ignore
        var ym = ['202010', '202011', '202012', '202101', '202102', '202103', '202104', '202105', '202106', '202107', '202108',
            '202109', '202110', '202111', '202112', '202201',
            '202202', '202203', '202204', '202205', '202206', '202207', '202208', '202209', '202210', '202211', '202212'];
        // prettier-ignore
        var tid = ['11', '12', '13', '14', '15', '16', '17', '18', '19', '20'];
        // prettier-ignore
        var data = [[0, 0, 0], [1, 0, 0], [2, 0, 0], [3, 0, 0], [4, 0, 0], [5, 0, 0], [6, 0, 0], [7, 0, 0], [8, 0, 0],
            [9, 0, 0], [10, 0, 0], [11, 0, 0], [12, 0, 0], [13, 0, 19949230.63821978], [14, 0, 30282828.51434062],
            [15, 0, 17832740.293764636], [16, 0, 25585185.5193024], [17, 0, 32561277.96145794], [18, 0, 29613736.345784683],
            [19, 0, 32277656.13807464], [20, 0, 30708158.053601395], [21, 0, 0], [22, 0, 0], [23, 0, 0], [24, 0, 0],
            [25, 0, 0], [26, 0, 0], [0, 1, 0], [1, 1, 0], [2, 1, 0], [3, 1, 0], [4, 1, 0], [5, 1, 0], [6, 1, 0], [7, 1, 0],
            [8, 1, 0], [9, 1, 0], [10, 1, 0], [11, 1, 0], [12, 1, 0], [13, 1, 18307827.14162912], [14, 1, 27810798.144503925],
            [15, 1, 37057472.51715762], [16, 1, 28375148.03151626], [17, 1, 35895618.972238496], [18, 1, 22590774.46860851],
            [19, 1, 19986403.053916495], [20, 1, 17771706.66334925], [21, 1, 0], [22, 1, 0], [23, 1, 0], [24, 1, 0],
            [25, 1, 0], [26, 1, 0], [0, 2, 0], [1, 2, 0], [2, 2, 0], [3, 2, 0], [4, 2, 0], [5, 2, 0],
            [6, 2, 26453052.739710245], [7, 2, 26991535.342675246], [8, 2, 16029627.210389953], [9, 2, 22624332.155099746],
            [10, 2, 14315994.001703432], [11, 2, 20572626.164978247], [12, 2, 20210832.479036503], [13, 2, 29094108.849289726],
            [14, 2, 23910692.033219], [15, 2, 19498011.144425377], [16, 2, 15809540.151570264], [17, 2, 26725682.979812644],
            [18, 2, 22081749.2476194], [19, 2, 0], [20, 2, 0], [21, 2, 0], [22, 2, 0], [23, 2, 0], [24, 2, 0], [25, 2, 0],
            [26, 2, 0], [0, 3, 0], [1, 3, 0], [2, 3, 0], [3, 3, 0], [4, 3, 0], [5, 3, 0], [6, 3, 12748523.496675367],
            [7, 3, 10922325.405639356], [8, 3, 11516496.479048759], [9, 3, 12447398.784860587], [10, 3, 12225230.999390636],
            [11, 3, 9869224.38092755], [12, 3, 13121570.659814386], [13, 3, 12284862.591893673], [14, 3, 16451695.900479222],
            [15, 3, 5952161.359001619], [16, 3, 10000289.002900884], [17, 3, 14989923.50599568], [18, 3, 12933982.33786649],
            [19, 3, 0], [20, 3, 0], [21, 3, 0], [22, 3, 0], [23, 3, 0], [24, 3, 0], [25, 3, 0], [26, 3, 0], [0, 4, 0],
            [1, 4, 0], [2, 4, 0], [3, 4, 0], [4, 4, 0], [5, 4, 0], [6, 4, 40343660.81100561], [7, 4, 48885693.75096252],
            [8, 4, 25306135.80795553], [9, 4, 23413149.018823966], [10, 4, 15882271.408666845], [11, 4, 17278478.955364294],
            [12, 4, 27276572.324141044], [13, 4, 28320277.28521482], [14, 4, 33451579.360865958], [15, 4, 50394394.61438681],
            [16, 4, 43815872.746391], [17, 4, 53682734.48701839], [18, 4, 34341706.49138478], [19, 4, 20748507.390957054],
            [20, 4, 27475899.49999562], [21, 4, 0], [22, 4, 0], [23, 4, 0], [24, 4, 0], [25, 4, 0], [26, 4, 0],
            [0, 5, 57517920.0], [1, 5, 57517920.0], [2, 5, 59435184.0], [3, 5, 59435184.0], [4, 5, 53683392.0],
            [5, 5, 59435184.0], [6, 5, 57517920.0], [7, 5, 59435184.0], [8, 5, 25365373.30510388], [9, 5, 17722562.59354251],
            [10, 5, 18784401.761947345], [11, 5, 18683156.44263951], [12, 5, 19691414.696289573], [13, 5, 0], [14, 5, 0],
            [15, 5, 0], [16, 5, 0], [17, 5, 0], [18, 5, 0], [19, 5, 0], [20, 5, 0], [21, 5, 0], [22, 5, 0], [23, 5, 0],
            [24, 5, 0], [25, 5, 0], [26, 5, 0], [0, 6, 0], [1, 6, 0], [2, 6, 0], [3, 6, 0], [4, 6, 0], [5, 6, 0],
            [6, 6, 21598413.881003212], [7, 6, 21689769.500389], [8, 6, 19768904.584822975], [9, 6, 29283782.363458727],
            [10, 6, 15826031.508694235], [11, 6, 21573833.789816972], [12, 6, 18625940.383694723], [13, 6, 27761749.415468726],
            [14, 6, 20101363.964512486], [15, 6, 21627330.576628994], [16, 6, 16917980.41141698], [17, 6, 27416633.92803672],
            [18, 6, 13096242.744642457], [19, 6, 0], [20, 6, 0], [21, 6, 0], [22, 6, 0], [23, 6, 0], [24, 6, 0], [25, 6, 0],
            [26, 6, 0], [0, 7, 0], [1, 7, 0], [2, 7, 0], [3, 7, 0], [4, 7, 0], [5, 7, 0], [6, 7, 0], [7, 7, 0], [8, 7, 0],
            [9, 7, 0], [10, 7, 0], [11, 7, 0], [12, 7, 0], [13, 7, 0], [14, 7, 0], [15, 7, 6113681.169486776],
            [16, 7, 8464129.35819363], [17, 7, 10066577.314740924], [18, 7, 11945415.20419009], [19, 7, 13001554.547439799],
            [20, 7, 0], [21, 7, 0], [22, 7, 0], [23, 7, 0], [24, 7, 0], [25, 7, 0], [26, 7, 0], [0, 8, 0], [1, 8, 0],
            [2, 8, 0], [3, 8, 0], [4, 8, 0], [5, 8, 0], [6, 8, 0], [7, 8, 0], [8, 8, 0], [9, 8, 0], [10, 8, 0], [11, 8, 0],
            [12, 8, 0], [13, 8, 0], [14, 8, 0], [15, 8, 21787388.820796404], [16, 8, 22923307.921352338],
            [17, 8, 27068219.449265603], [18, 8, 32614452.210933734], [19, 8, 39342238.25798779], [20, 8, 35538475.27128475],
            [21, 8, 35505625.188382484], [22, 8, 30663953.81865923], [23, 8, 29465236.23169983], [24, 8, 24423956.87580979],
            [25, 8, 25266750.952170387], [26, 8, 23125784.828486394], [0, 9, 7767360.0], [1, 9, 7516800.0], [2, 9, 7767360.0],
            [3, 9, 7767360.0], [4, 9, 7050498.94405], [5, 9, 7787679.316950001], [6, 9, 16795249.156647503],
            [7, 9, 15311331.902693002], [8, 9, 9922842.0258], [9, 9, 7975284.862155754], [10, 9, 7699969.582145753],
            [11, 9, 9681171.025018757], [12, 9, 10934222.788689751], [13, 9, 0], [14, 9, 0], [15, 9, 0], [16, 9, 0],
            [17, 9, 0], [18, 9, 0], [19, 9, 0], [20, 9, 0], [21, 9, 0], [22, 9, 0], [23, 9, 0], [24, 9, 0], [25, 9, 0],
            [26, 9, 0]]


        option = {
            title: {
                text: "发电量数据可视化"
            },
            tooltip: {
                position: 'left',
                formatter: function (params) {
                    // 获取 x 值和 y 值
                    var xValue = ym[params.data.value[0]];
                    var yValue = tid[params.data.value[1]];

                    return '月份：' + xValue + '<br/>' + ' 风场id：' + yValue + '<br/>' + ' 该月发电量：' + params.data.value[2];
                }
            },
            visualMap: {
                max: 50000000,
                inRange: {
                    color: [
                        '#313695',
                        '#4575b4',
                        '#74add1',
                        '#abd9e9',
                        '#e0f3f8',
                        '#ffffbf',
                        '#fee090',
                        '#fdae61',
                        '#f46d43',
                        '#d73027',
                        '#a50026'
                    ]
                }
            },
            xAxis3D: {
                type: 'category',
                data: ym,
                top: '6%',
                name: '年月'
            },
            yAxis3D: {
                type: 'category',
                data: tid,
                top: '6%',
                name: '风场'
            },
            zAxis3D: {
                type: 'value',
                top: '6%',
                name: '发电量'
            },
            grid3D: {
                boxWidth: 120,
                boxHeight: 96,
                boxDepth: 64,
                axisLine: {
                    show: true,
                },
                splitLine: {//平面上的分隔线。
                    show: true,//立体网格线
                    // interval:100,//坐标轴刻度标签的显示间隔，在类目轴中有效
                    splitArea: {
                        show: true,
                        // interval:100,//坐标轴刻度标签的显示间隔，在类目轴中有效
                        areaStyle: {
                            color: ['rgba(250,250,250,0.3)', 'rgba(200,200,200,0.3)', 'rgba(250,250,250,0.3)', 'rgba(200,200,200,0.3)']
                        }
                    },
                },
                axisPointer: {//坐标轴指示线。
                    show: true,//鼠标在chart上的显示线
                    // lineStyle:{
                    //     color:'#000',//颜色
                    //     opacity:1,
                    //     width:5//厚度（虽然为宽表现为高度），对应length*(宽)
                    // }
                },
                viewControl: {//viewControl用于鼠标的旋转，缩放等视角控制。(以下适合用于地球自转等)
                    projection: 'perspective',//默认为透视投影'perspective'，也支持设置为正交投影'orthographic'。
                    autoRotate: true,//会有自动旋转查看动画出现,可查看每个维度信息
                    // autoRotateDirection:'ccw',//物体自传的方向。默认是 'cw' 也就是从上往下看是顺时针方向，也可以取 'ccw'，既从上往下看为逆时针方向。
                    autoRotateSpeed: 1.5,//物体自传的速度
                    // autoRotateAfterStill:2,//在鼠标静止操作后恢复自动旋转的时间间隔。在开启 autoRotate 后有效。
                    distance: 200,//默认视角距离主体的距离(常用)
                    // alpha:1,//视角绕 x 轴，即上下旋转的角度(与beta一起控制视野成像效果)
                    beta: 15,//视角绕 y 轴，即左右旋转的角度。
                    // center:[]//视角中心点，旋转也会围绕这个中心点旋转，默认为[0,0,0]。
                    // zlevel://组件所在的层。
                    animation: true
                },
                light: {
                    main: {
                        intensity: 1.2,
                        shadow: true
                    },
                    ambient: {
                        intensity: 0.5
                    }
                }
            },
            series: [
                {
                    type: 'bar3D',
                    data: data.map(function (item) {
                        return {
                            value: [item[0], item[1], item[2]]
                        };
                    }),
                    shading: 'lambert',
                    label: {
                        fontSize: 16,
                        borderWidth: 1
                    },
                    emphasis: {
                        label: {
                            fontSize: 20,
                            color: '#900'
                        },
                        itemStyle: {
                            color: '#3ba272'
                        }
                    }
                }
            ]
        };
        d3chart.setOption(option)
        window.onresize = function () {
            d3chart.resize();
        }
    }

    d3chart()

    window.addEventListener('resize', function () {

        // 调用resize方法，使图表自适应页面尺寸
        var tmpmain = echarts.init(document.getElementById('main'), null, {renderer: 'svg'});
        tmpmain.resize();

        function setopbyid(id) {
            echarts.init(document.getElementById(id), null, {renderer: 'svg'}).setOption({
                tooltip: {
                    position: ['50%', '50%']
                }
            })
        }

        setopbyid('main');


        var tmpmain2 = echarts.init(document.getElementById('main2'), null, {renderer: 'svg'});
        tmpmain2.resize();
        setopbyid('main2');

        var tmprose = echarts.init(document.getElementById('rosechart'), null, {renderer: 'svg'});
        tmprose.resize();

        var tmp3dchart = echarts.init(document.getElementById('3dchart'));
        tmp3dchart.resize();
    });

</script>
</body>
</html>
